{% extends 'base.html' %}
{% load static %}
{% block content %}

<header class="hero-detail">
</header>


<!-- NOTE: This is the hero container -->
<div class="container detail-main-container">
  <div class="detail-left">
    <div class="detail-cat-app">
      <span class="detail-category">{{ recipe.category }}</span>
      <span class="detail-appliance">{{ recipe.appliance }}</span>
    </div>
    <h2 class="detail-title">
      {{ recipe.name }}
    </h2>
    <div class="detail-author">
      Recipe by <a href="{% url 'profile' recipe.author %}">{{ recipe.author }}</a>
    </div>
    <div class="detail-rating">
      <img class="detail-view-star" src="{% static 'main_app/images/star-red.png' %}" alt="rating-star">
      {% if recipe.total_reviews %}
      <span class="detail-view-rating">{{ recipe.average_rating|floatformat:1 }} ({{ recipe.total_reviews }})</span>
      {% else %}
      <span class="detail-view-rating">No Reviews Yet</span>
      {% endif %}
    </div>
    <div class="detail-crud-buttons-container">
      {% if user.is_authenticated and user == recipe.author %}
          <a class="btn detail-crud-btn" href="{% url 'recipes_update' recipe.id %}">Edit</a>
          <a class="btn detail-crud-btn" href="{% url 'recipes_delete' recipe.id %}">Delete</a>
      {% endif %}
    </div>
  </div>
  <div class="detail-right">
    <div class="detail-image-container">
      <img class="detail-image" src="{{ photo.url }}" alt="photo">
    </div>
    <div class="detail-image-offset-bkg"></div>
  </div>
</div>


<!-- NOTE: This is the info container -->
<div class="container detail-info-container">
  <div>
    <h3>Description</h3>
    <p><pre>{{ recipe.description }}</pre></p>
  </div>
  <div>
    <h3>Ingredients</h3>
    <p><pre>{{ recipe.ingredients }}</pre></p>
  </div>
  <div>
    <h3>Directions</h3>
    <p><pre>{{ recipe.directions }}</pre></p>
  </div>
</div>

<!-- NOTE: This is the reviews container -->
<div class="container reviews-main-container">
  <div><h3>Reviews</h3></div>
  <div>
    <form method="POST" action="{% url 'add_review' recipe.id %}">
      {% csrf_token %}
      {{ review_form.as_div }}
      <button type="submit">Submit</button>
    </form>
  </div>
  <div></div>
</div>
<!-- 
<div class="row">
  <div class="col s6">
    <div class="card">
      <div class="card-content">
        <h3 class="card-title">{{ recipe.name }}</h3>
        <p>Description: <pre>{{ recipe.description }}</pre></p>
        <p>Time: {{ recipe.time }}</p>
        <p>Servings: {{ recipe.servings }}</p>
        <p>Ingredients: <pre>{{ recipe.ingredients }}</pre></p>
        <p>Directions: <pre>{{ recipe.directions }}</pre></p>
      </div>
      <div class="recipe-photos">
        <h2>Recipe Photos</h2>
        {% if photo %}
            <img src="{{ photo.url }}" alt="Recipe Photo">
        {% else %}
            <p>No photos available for this recipe.</p>
        {% endif %}
    </div>
      {% if user.is_authenticated %}
        {% if user == recipe.author %}
            <div class="card-action">
                <form action="{% url 'recipe_add_photo' recipe.id %}" enctype="multipart/form-data" method="POST" class="card-panel">
                    {% csrf_token %}
                    <input type="file" name="photo-file">
                    <br><br>
                    {% if photo %}
                        <button type="submit" class="btn">Replace Photo</button>
                    {% else %}
                        <button type="submit" class="btn">Upload Photo</button>
                    {% endif %}
                </form>
        {% endif %}
                <form method="post" action="{% url 'bookmark_recipe' recipe.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn waves-effect waves-light">
                    {% if user in recipe.bookmarks.all %}
                        Remove from Bookmarks
                    {% else %}
                        Bookmark Recipe
                    {% endif %}
                    </button>
                </form>
            </div>
        {% endif %}
      </div>
    </div>
  </div>
</div> -->

<br><br><br><br><br>

<!-- REVIEWS -->
<h2>Reviews</h2>
{% if user.is_authenticated and user != recipe.author and not has_reviewed %}
<button>Add Review</button>
<div>
  review form
  <form class="review-form-container" method="POST" action="{% url 'add_review' recipe.id %}">
    {% csrf_token %}
    {{ review_form }}
    <button type="submit">Submit</button>
  </form>
</div>
{% endif %}

<!-- reviews listed -->
<div>
  {% if recipe.review_set.all %}
    {% for review in recipe.review_set.all %}
      <h4><pre>{{ review.user }}</pre></h4>
      <p>{{ review.rating }}</p>
      <p>{{ review.content }}</p>
    {% if user.is_authenticated and user == review.user %}
      <a href="{% url 'delete_review' review.id %}">Delete Review</a>
    {% endif %}
    <hr>
    {% endfor %}
  {% else %}
  <p>No reviews for this recipe yet</p>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    let labelContent = document.querySelector('label[for="id_content"]');
    let labelRating = document.querySelector('label[for="id_rating"]');
    if (labelContent) {
      labelContent.classList.add('review-form-label');
    }
    if (labelRating) {
      labelRating.classList.add('review-form-label');
    }

    let textareaContent = document.getElementById('id_content');
    if (textareaContent) {
      textareaContent.classList.add('review-form-textarea', 'mb-3');
      textareaContent.rows = 5;
    }

    let selectRating = document.getElementById('id_rating');
    if (selectRating) {
      selectRating.classList.add('form-control', 'review-form-select');
    }

    let submitButton = document.querySelector('button[type="submit"]');
    if (submitButton) {
      submitButton.classList.add('btn', 'review-form-btn', 'mt-3');
    }
  });
</script>


{% endblock %}



<!-- <div>
  <form method="POST" action="/recipes/4/reviews/add/">
    <input type="hidden" name="csrfmiddlewaretoken" value="PqUHkwye9mT5UzECW6mE8ukFEv1vXiILtwUEJlQ5cz1rqaaKxK24oXYpaUngtiiN">
    <p>
  <label for="id_content">Content:</label>
  <textarea name="content" cols="40" rows="10" maxlength="2000" required="" id="id_content"></textarea>
  
  
</p>


<p>
  <label for="id_rating">Rating:</label>
  <select name="rating" id="id_rating">
<option value="1">1</option>

<option value="2">2</option>

<option value="3">3</option>

<option value="4">4</option>

<option value="5" selected="">5</option>

</select>
  
  
    
  
</p>
    <button type="submit">Submit</button>
  </form>
</div> -->